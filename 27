Private Sub btnGenerarExcel_Click()

    Dim fso As Object
    Dim rutaPlantilla As String
    Dim rutaSalida As String
    Dim xlApp As Object
    Dim wb As Object
    Dim ws As Object
    
    rutaPlantilla = CurrentProject.Path & "\Plantilla_Incidencias.xlsm"
    rutaSalida = CurrentProject.Path & "\Salida\Incidencias_Editar.xlsm"
    
    Set fso = CreateObject("Scripting.FileSystemObject")
    
    ' üî¥ Si existe archivo anterior, eliminarlo
    If fso.FileExists(rutaSalida) Then
        fso.DeleteFile rutaSalida, True
    End If
    
    ' Copiar plantilla limpia
    fso.CopyFile rutaPlantilla, rutaSalida
    
    ' Abrir Excel
    Set xlApp = CreateObject("Excel.Application")
    xlApp.Visible = False
    
    Set wb = xlApp.Workbooks.Open(rutaSalida)
    Set ws = wb.Sheets(1)
    
    ' Limpiar datos por seguridad
    ws.Rows("2:" & ws.Rows.Count).ClearContents
    
    ' Insertar datos desde consulta
    Dim rs As DAO.Recordset
    Dim fila As Long
    
    Set rs = CurrentDb.OpenRecordset("qryExportarIncidencias")
    fila = 2
    
    Do While Not rs.EOF
        
        ws.Cells(fila, 1).Value = rs!ID
        ws.Cells(fila, 2).Value = rs!Title
        ws.Cells(fila, 3).Value = rs![Descripci√≥n de incidencia]
        ws.Cells(fila, 4).Value = rs![Acci√≥n a seguir]
        
        fila = fila + 1
        rs.MoveNext
        
    Loop
    
    rs.Close
    Set rs = Nothing
    
    wb.Save
    wb.Close
    xlApp.Quit
    
    Set wb = Nothing
    Set xlApp = Nothing
    
    MsgBox "Archivo listo para edici√≥n.", vbInformation
    
    ' Abrir el archivo al usuario
    Application.FollowHyperlink rutaSalida

End Sub
if df is not None:
    print(df.head())
