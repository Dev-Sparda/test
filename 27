Option Explicit

Sub EnviarCambiosAAccess()

    Dim conn As Object
    Dim rutaBD As String
    Dim ultimaFila As Long
    Dim i As Long
    Dim sql As String
    
    ' Confirmación de seguridad
    If MsgBox("¿Deseas enviar los cambios a SharePoint?", _
              vbYesNo + vbQuestion, _
              "Confirmar envío") = vbNo Then
        Exit Sub
    End If
    
    ' Ruta automática a la base (misma carpeta superior)
    rutaBD = ThisWorkbook.Path & "\..\Base.accdb"
    
    Set conn = CreateObject("ADODB.Connection")
    conn.Open "Provider=Microsoft.ACE.OLEDB.12.0;Data Source=" & rutaBD
    
    ultimaFila = Cells(Rows.Count, 1).End(xlUp).Row
    
    For i = 2 To ultimaFila
    
        ' Solo actualizar si hay algo escrito en I, J o K
        If Cells(i, 9).Value <> "" _
        Or Cells(i, 10).Value <> "" _
        Or Cells(i, 11).Value <> "" Then
        
            sql = "UPDATE TBL_INCIDENCIAS_ROBOT SET " & _
                  "[Comentario1] = '" & Replace(Cells(i, 9).Value, "'", "''") & "', " & _
                  "[Comentario2] = '" & Replace(Cells(i, 10).Value, "'", "''") & "', " & _
                  "[Comentario3] = '" & Replace(Cells(i, 11).Value, "'", "''") & "' " & _
                  "WHERE ID = " & Cells(i, 1).Value
                  
            conn.Execute sql
            
        End If
        
    Next i
    
    conn.Close
    Set conn = Nothing
    
    MsgBox "Datos actualizados correctamente.", vbInformation

End Sub
