-- TABLA 1: TIPOS_VALIDACION
CREATE TABLE IF NOT EXISTS TIPOS_VALIDACION (
    ID_TIPO INTEGER PRIMARY KEY,
    NOMBRE TEXT NOT NULL UNIQUE,
    DESCRIPCION TEXT NOT NULL
);

INSERT OR IGNORE INTO TIPOS_VALIDACION VALUES 
(1, 'INSUMOS', 'Validacion estructural en repositorio de insumos'),
(2, 'AREA_TRABAJO', 'Validacion estructural en area de trabajo'),
(3, 'REPORTES_ENVIADOS', 'Validacion cruzada con TB_ACUSES_SECCIONES'),
(4, 'ACUSES', 'Validacion estructural en carpeta de acuses');

-- TABLA 2: CONFIG_VALIDACIONES
CREATE TABLE IF NOT EXISTS CONFIG_VALIDACIONES (
    ID_CONFIG INTEGER PRIMARY KEY AUTOINCREMENT,
    ID_TIPO INTEGER NOT NULL,
    NOMBRE_LOGICO TEXT NOT NULL,
    RUTA_BASE TEXT NOT NULL,
    ID_PAQUETE INTEGER,
    ID_SECCION INTEGER,
    FECHA_INICIO_VALIDACION DATE,
    PATRON_ARCHIVO TEXT,
    ESTATUS INTEGER DEFAULT 1,
    CREADO TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- TABLA 3: CAT_TIPOS_EXCEPCION
CREATE TABLE IF NOT EXISTS CAT_TIPOS_EXCEPCION (
    ID_TIPO_EXCEPCION INTEGER PRIMARY KEY,
    NOMBRE TEXT NOT NULL UNIQUE,
    DESCRIPCION TEXT NOT NULL
);

INSERT OR IGNORE INTO CAT_TIPOS_EXCEPCION VALUES 
(1, 'MULTIPLES_ARCHIVOS_POR_TRANSMISION', 'Una transmision corresponde a N archivos fisicos'),
(2, 'TRANSMISION_DUPLICADA', 'Mismo archivo contado como multiples transmisiones');

-- TABLA 4: EXCEPCIONES_VALIDACION
CREATE TABLE IF NOT EXISTS EXCEPCIONES_VALIDACION (
    ID_EXCEPCION INTEGER PRIMARY KEY AUTOINCREMENT,
    ID_CONFIG INTEGER NOT NULL,
    ID_TIPO_EXCEPCION INTEGER NOT NULL,
    FECHA_DATOS_EXCEPCION DATE,
    PARAMETRO_NUMERICO INTEGER,
    JUSTIFICACION TEXT NOT NULL,
    ESTATUS INTEGER DEFAULT 1,
    CREADO TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- TABLA 5: RESULTADOS_ESTRUCTURA (agrupados por carpeta)
CREATE TABLE IF NOT EXISTS RESULTADOS_ESTRUCTURA (
    ID_RESULTADO INTEGER PRIMARY KEY AUTOINCREMENT,
    ID_CONFIG INTEGER NOT NULL,
    FECHA_EJECUCION DATE DEFAULT CURRENT_DATE,
    TIPO_VALIDACION TEXT NOT NULL,
    RUTA_RELATIVA_CARPETA TEXT NOT NULL,
    PATRON_ERROR TEXT NOT NULL,
    CANTIDAD_ARCHIVOS_AFECTADOS INTEGER NOT NULL,
    EJEMPLO_ARCHIVO TEXT NOT NULL,
    INCONSISTENCIA TEXT NOT NULL
);

-- TABLA 6: RESULTADOS_TRANSMISIONES (uno por acuse)
CREATE TABLE IF NOT EXISTS RESULTADOS_TRANSMISIONES (
    ID_RESULTADO INTEGER PRIMARY KEY AUTOINCREMENT,
    ID_CONFIG INTEGER NOT NULL,
    FECHA_EJECUCION DATE DEFAULT CURRENT_DATE,
    FECHA_DATOS_ACUSE DATE NOT NULL,
    TRANSMISIONES_ESPERADAS INTEGER NOT NULL,
    TRANSMISIONES_ESPERADAS_AJUSTADAS INTEGER NOT NULL,
    PATRON_ARCHIVO_APLICADO TEXT NOT NULL,
    ARCHIVOS_ENCONTRADOS INTEGER NOT NULL,
    ARCHIVOS_VALIDOS INTEGER NOT NULL,
    INCONSISTENCIA TEXT
);
