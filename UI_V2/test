# En ui_main.py
def verificar_y_notificar(self):
    from db_manager import get_fases_vencidas_sin_finalizar
    from teams_notifier import enviar_alertas_por_responsable

    fases = get_fases_vencidas_sin_finalizar()
    
    if not fases:
        status = ctk.CTkLabel(self, text="✅ No hay fases vencidas.", text_color="green")
        status.pack()
        self.after(3000, status.destroy)
        return

    # Enviar tarjetas por responsable
    resultados = enviar_alertas_por_responsable(fases)
    total_exitos = sum(resultados.values())
    
    if total_exitos == len(resultados):
        msg = f"✅ Alertas enviadas a {len(resultados)} responsable(s)"
        color = "green"
    else:
        fallidos = [r for r, ok in resultados.items() if not ok]
        msg = f"⚠️ Algunas alertas fallaron: {', '.join(fallidos)}"
        color = "orange"

    status = ctk.CTkLabel(self, text=msg, text_color=color)
    status.pack()
    self.after(4000, status.destroy)
